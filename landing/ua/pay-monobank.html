<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Оплата через monobank • CortexFin</title>
  <link rel="icon" href="/assets/app-icon.png"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
:root{color-scheme:dark}
html,body{background:#0b1220;color:#e2e8f0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial}
a{color:#67e8f9}
.container{max-width:960px;margin:0 auto;padding:20px}
.card{background:#0f172a;border:1px solid #20283a;border-radius:16px;padding:20px}
.btn{display:inline-block;padding:10px 14px;border-radius:10px;background:#22d3ee;color:#00131a;text-decoration:none;font-weight:700}
.btn.ghost{background:#1e293b;color:#e2e8f0;border:1px solid #334155}
.muted{opacity:.85}
header.nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
nav a{margin-left:12px;text-decoration:none}
h1,h2,h3{margin:.3em 0}
code{background:#0b1220;padding:2px 6px;border-radius:6px;border:1px solid #273142}
</style>
  
</head>
<body>
  <div class="container">
    <header class="nav">
      <a href="/uk/index.html" class="muted" style="font-weight:600">CortexFin</a>
      <nav class="muted">
        <a href="/uk/index.html">Головна</a>
        <a href="/uk/support.html">Підтримка</a>
        <a href="/uk/terms.html">Умови</a>
        <a href="/uk/privacy.html">Приватність</a>
        <a href="/en/index.html" class="btn ghost" style="padding:6px 10px">EN</a>
      </nav>
    </header>
    
<div class="card">
  <h1>Оплата через monobank</h1>
  <p class="muted">Gold — $1400 (фіксовано). Silver — $69, Platinum — $1500.</p>
  <p id="ctx" class="muted"></p>

  <div id="sumBox" style="display:none;margin-top:8px;padding:10px;border-radius:10px;background:#0b1220;border:1px solid #273142">
    <div class="muted" style="font-size:14px">Рекомендована сума поповнення:</div>
    <div style="font-size:20px;font-weight:800" id="sumUAH">— ₴</div>
    <div class="muted" style="font-size:13px" id="sumNote">Розраховано як ціна в $ × курс НБУ.</div>
  </div>

  <div style="margin-top:12px">
    <a id="btnJar" class="btn">Внести в банку</a>
    <a id="btnClaim" class="btn ghost">Я оплатив — видати доступ</a>
  </div>

  <p class="muted" style="margin-top:12px">
    Після оплати натисніть «Я оплатив — видати доступ». Якщо щось — телеграм @cortexfin.
    У коментарі в банці вкажіть свій email (щоб ми швидше звірили).
  </p>

  <a href="/uk/index.html" class="btn ghost" style="margin-top:16px">Повернутися на головну</a>
</div>

<script>
  const JARS = {
    SE: "https://send.monobank.ua/jar/8254PBnk66",
    GF: "https://send.monobank.ua/jar/7mNKkrhiUw",
    PF: "https://send.monobank.ua/jar/5La4vaWdbh",
  };
  const EDGE_URL = "https://xdofjorgomwdyawmwbcj.functions.supabase.co";
  const FALLBACK_USD_UAH = 42.00;
  const PRICE_USD = { SE: 69, GF: 1400, PF: 1500 };

  const p = new URL(location.href).searchParams;
  const tier = (p.get('tier') || '').toUpperCase();
  const email = p.get('email') || '';
  const holdId = p.get('hold_id') || '';
  const jar = JARS[tier] || JARS.SE;

  document.getElementById('ctx').textContent =
    `Тир: ${tier}. Бронь № ${holdId || '—'}. Email: ${email || '—'}.`;

  document.getElementById('btnJar').href = jar;
  document.getElementById('btnJar').setAttribute('target','_blank');

  document.getElementById('btnClaim').onclick = () => {
    const u = new URL('/uk/thanks.html', location.origin);
    if (tier)   u.searchParams.set('tier', tier.toLowerCase());
    if (email)  u.searchParams.set('email', email);
    if (holdId) u.searchParams.set('hold_id', holdId);
    location.href = u.toString();
  };

  async function fetchGoldPriceUSD(){
    try{
      const r = await fetch(`${EDGE_URL}/public-metrics`, { headers: { "Authorization": "Bearer none" }});
      if(!r.ok) throw 0;
      const m = await r.json();
      return (Number(m.gf_price_cents||0) / 100) || null;
    }catch{ return null; }
  }
  async function fetchUsdUah(){
    try{
      const r = await fetch('https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?valcode=USD&json', {cache:'no-store'});
      if(!r.ok) throw 0;
      const arr = await r.json();
      const rate = Number(arr?.[0]?.rate);
      return rate || FALLBACK_USD_UAH;
    }catch{ return FALLBACK_USD_UAH; }
  }

  (async function showSuggested(){
    let usd = PRICE_USD[tier] ?? null;
    if (tier === 'GF' && usd == null) usd = await fetchGoldPriceUSD();
    if (!usd) return;

    const rate = await fetchUsdUah();
    const uah = Math.round(usd * rate);

    const box = document.getElementById('sumBox');
    document.getElementById('sumUAH').textContent = uah.toLocaleString('uk-UA') + ' ₴';
    document.getElementById('sumNote').innerHTML =
      `Ціна: <code>$${usd.toLocaleString('en-US')}</code> × курс НБУ <code>${rate.toFixed(2)}</code>. ` +
      `Можна округлити до зручної суми.`;
    box.style.display = 'block';
  })();
</script>

  </div>
</body>
</html>